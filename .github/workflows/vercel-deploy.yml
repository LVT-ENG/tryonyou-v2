name: Vercel Deploy

on:
  push:
    branches: [main, production]
    paths:
      - 'dist/**'
  workflow_dispatch:

jobs:
  deploy-to-vercel:
    runs-on: ubuntu-latest

    steps:
    - name: "â¬‡ï¸ Checkout del repositorio"
      uses: actions/checkout@v3

    - name: "ğŸ“¦ Setup Node.js"
      uses: actions/setup-node@v3
      with:
        node-version: 18

    - name: "ğŸ›  Instalar Vercel CLI"
      run: npm install -g vercel

    - name: "ğŸ“¥ Instalar dependencias"
      run: npm ci

    - name: "ğŸ“‹ Ejecutar pruebas JavaScript"
      run: npm test

    - name: "ğŸ Setup Python"
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'

    - name: "ğŸ“¥ Instalar dependencias de Python"
      run: pip install -r requirements.txt

    - name: "âœ… Ejecutar pruebas Python"
      run: pytest -q

    - name: "ğŸ”¨ Construir proyecto"
      run: npm run build

    - name: "ğŸ”‘ Configurar y autenticar con Vercel"
      run: |
        vercel pull --yes --environment=production --token=${{ secrets.VERCEL_TOKEN }}
        vercel build --token=${{ secrets.VERCEL_TOKEN }}
        vercel deploy --prod --token=${{ secrets.VERCEL_TOKEN }}
