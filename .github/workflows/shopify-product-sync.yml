name: Shopify Product Sync

on:
  push:
    paths:
      - 'shopify/products.csv'

jobs:
  upload:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Trigger Make Scenario
        # Requires MAKE_WEBHOOK_URL secret to be configured in GitHub repository settings
        # The webhook URL should point to your Make.com scenario endpoint
        env:
          WEBHOOK_URL: ${{ secrets.MAKE_WEBHOOK_URL }}
        run: |
          if [ -z "$WEBHOOK_URL" ]; then
            echo "Error: MAKE_WEBHOOK_URL secret is not configured"
            echo "Please add MAKE_WEBHOOK_URL to your repository secrets"
            exit 1
          fi
          echo "Triggering Make.com webhook..."
          HTTP_CODE=$(curl -X POST \
            -H "Content-Type: application/json" \
            -d "{\"repository\":\"${{ github.repository }}\",\"branch\":\"${{ github.ref_name }}\",\"commit\":\"${{ github.sha }}\",\"workflow\":\"${{ github.workflow }}\"}" \
            -w "%{http_code}" \
            -o /tmp/response.txt \
            "$WEBHOOK_URL")
          
          if [ "$HTTP_CODE" -ge 200 ] && [ "$HTTP_CODE" -lt 300 ]; then
            echo "Make.com scenario triggered successfully (HTTP $HTTP_CODE)"
          else
            echo "Failed to trigger webhook (HTTP $HTTP_CODE)"
            echo "Response:"
            cat /tmp/response.txt
            exit 1
          fi

