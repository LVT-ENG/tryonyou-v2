name: Vercel Deploy

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  deploy-to-vercel:
    runs-on: ubuntu-latest
    container:
      image: node:18
      options: --network=host

    steps:
    - name: "â¬‡ï¸ Checkout del repositorio"
      uses: actions/checkout@v3

    - name: "ğŸ“¦ Setup Node.js"
      uses: actions/setup-node@v3
      with:
        node-version: 18

    - name: "ğŸ“¥ Instalar dependencias"
      run: npm ci

    - name: "ğŸ“‹ Ejecutar pruebas JavaScript"
      run: npm test

    - name: "ğŸ Setup Python"
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'

    - name: "ğŸ“¥ Instalar dependencias de Python"
      run: pip install -r requirements.txt

    - name: "âœ… Ejecutar pruebas Python"
      run: pytest -q

    - name: "ğŸš€ Desplegar y registrar"
      run: make all
      env:
        VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
        GITHUB_REPO_ID: ${{ secrets.GITHUB_REPO_ID }}
        NOTION_TOKEN: ${{ secrets.NOTION_TOKEN }}
        NOTION_DATABASE_ID: ${{ secrets.NOTION_DATABASE_ID }}
